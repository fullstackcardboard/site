!function(e){var t={};function a(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(s,r,function(t){return e[t]}.bind(null,r));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=12)}([function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));class s{constructor(e,t,a,s,r){this.id=e,this.frontImage=t,this.rearImage=a,this.instructions=s,this.group=r}}},function(e,t,a){"use strict";t.a={shuffle:function(e){for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}},deepCopy:function(e){return JSON.parse(JSON.stringify(e))},findBootstrapEnvironment:function(){let e=["xs","sm","md","lg","xl"],t=document.createElement("div");document.body.appendChild(t);let a=e.shift();for(let s of e.reverse())if(t.classList.add(`d-${s}-none`),"none"===window.getComputedStyle(t).display){a=s;break}return document.body.removeChild(t),a},hide:function(e){(e||e.classList)&&e.classList.add("d-none")},show:function(e){(e||e.classList)&&e.classList.remove("d-none")}}},function(e,t,a){"use strict";t.a={CARD_DRAWN:"cardDrawn",RESHUFFLED:"reshuffled",RESHUFFLE:"reshuffle",GAME_LOADED:"loaded"}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));class s{save(e,t){window.localStorage.setItem(e,JSON.stringify(t))}load(e){return JSON.parse(window.localStorage.getItem(e))}clear(e){window.localStorage.removeItem(e)}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));class s{constructor(){this.cards=[],this.drawnCards=[],this.currentCard=null,this.nextCard=null,this.deckEmpty=!1,this.reshuffling=!1,this.hideDrawnCards=!1,this.showDiscardPile=!1,this.topDiscard=null,this.setTopDiscard=!1}}},function(e,t,a){"use strict";var s=a(1);var r=a(2);a.d(t,"a",(function(){return d}));const i=new class{preloadCardImages(e){for(let t=0;t<e.length;t++){const a=e[t];(new Image).src=a.frontImage,(new Image).src=a.rearImage}}};class d{constructor(e,t,a,s,d,n,c,o){this.cardViewModel=d,this.gameState=a,this.deckBuilderCallback=s,this.reshuffleCallback=n,this.updateCallback=c,this.eventBus=o;i.preloadCardImages(e);const l=setInterval(a=>{"complete"===document.readyState&&(clearInterval(l),this.cardViewModel.cards=e,this.buildDeck(),this.cardView=t,this.bindEventHandlers(),this.cardView.toggleLoadingVisibility(),this.cardView.toggleAppVisibility(),this.updateCards(),this.updateView(),this.gameState.getSavedState()&&this.cardView.showLoadGameModal(),this.eventBus&&this.eventBus.subscribe(r.a.RESHUFFLE,()=>{this.reshuffle()}))},1e3)}drawNextCard(){this.cardViewModel.drawnCards.push(this.cardViewModel.cards[this.cardViewModel.cards.length-1]),this.updateCards(),this.cardViewModel.deckEmpty&&(this.cardViewModel.nextCard=null),this.cardViewModel.hideDrawnCards=!1,this.cardViewModel.setTopDiscard=!0}resetCards(){s.a.shuffle(this.cardViewModel.drawnCards),this.cardViewModel.cards=this.cardViewModel.cards.concat(s.a.deepCopy(this.cardViewModel.drawnCards)),s.a.shuffle(this.cardViewModel.cards),this.cardViewModel.drawnCards=[]}updateCards(){this.cardViewModel.currentCard=this.cardViewModel.drawnCards[this.cardViewModel.drawnCards.length-1],this.cardViewModel.nextCard=this.cardViewModel.cards[this.cardViewModel.cards.length-1],this.cardViewModel.currentCard&&(this.cardViewModel.cards=this.cardViewModel.cards.filter(e=>e.id!=this.cardViewModel.currentCard.id)),this.cardViewModel.drawnCards.length>1&&this.cardViewModel.setTopDiscard&&(this.cardViewModel.topDiscard=this.cardViewModel.drawnCards[this.cardViewModel.drawnCards.length-2]),this.cardViewModel.deckEmpty=0===this.cardViewModel.cards.length}updateView(){this.cardView.updateCardDisplay(this.cardViewModel)}buildDeck(){this.deckBuilderCallback()}bindEventHandlers(){document.addEventListener("click",e=>{if(e.target&&e.target.dataset&&e.target.dataset.action){const t=e.target.dataset.action;"draw"===t?(this.drawNextCard(),this.updateView(this.cardViewModel),this.gameState.set(this.cardViewModel),this.updateCallback&&this.updateCallback(this.cardViewModel),this.eventBus&&this.eventBus.publish(r.a.CARD_DRAWN,this.cardViewModel.currentCard)):"railEra"===t?(this.resetCards(),this.buildDeck(),this.updateCards(),this.cardViewModel.era="rail",this.updateView(),this.gameState.set(this.cardViewModel)):"load"===t?(this.cardViewModel=this.gameState.getSavedState(),this.updateView(),this.eventBus&&this.eventBus.publish(r.a.GAME_LOADED,this.cardViewModel),this.updateCallback&&this.updateCallback(this.cardViewModel),this.eventBus&&this.eventBus.publish(r.a.CARD_DRAWN,this.cardViewModel.currentCard)):"newGame"===t?(this.gameState.clear(),window.location.reload()):"reshuffle"===t&&this.reshuffle()}})}reshuffle(){this.reshuffleCallback?this.reshuffleCallback():this.resetCards(),this.updateCards(),this.updateView(),this.gameState.set(this.cardViewModel),this.updateCallback&&this.updateCallback(this.cardViewModel),this.eventBus&&this.eventBus.publish(r.a.RESHUFFLED)}}},function(e,t,a){"use strict";var s=a(1);a.d(t,"a",(function(){return i}));const r=new class{constructor(){this.currentEnvironment=s.a.findBootstrapEnvironment()}createCurrentCardTemplate(e){if(!e)return'<div id="currentCardImageContainer"></div>';return`<div class="text-center ${this.slideClass}" id="currentCardImageContainer"><img class="img-fluid round-corners" style="height: ${this.imageHeight}vh !important;" src="${e.frontImage}"/></div>`}createNextCardTemplate(e){if(!e)return'<div id="nextCardImageContainer"></div>';return`<div class="text-center" id="nextCardImageContainer"><img class="img-fluid round-corners" style="height: ${this.imageHeight}vh !important;" src="${e.rearImage}"/></div>`}createDiscardPileTemplate(e){if(!e)return'<div id="currentCardImageContainer"></div>';return`<div class="text-center ${this.slideClass}" id="currentCardImageContainer"><img class="img-fluid round-corners" style="height: ${this.imageHeight}vh !important;" src="${e.frontImage}"/></div>`}get slideClass(){return"md"===this.currentEnvironment||"lg"===this.currentEnvironment||"xl"===this.currentEnvironment?"slide":"slide-mobile"}get imageHeight(){return"lg"===this.currentEnvironment||"xl"===this.currentEnvironment?50:30}};class i{get currentCardContainer(){return document.getElementById("currentCard")}get nextCardContainer(){return document.getElementById("nextCard")}get discardPileContainer(){return document.getElementById("discardPile")}updateCardDisplay(e){if(this.toggleDrawButton(e),this.hideRailEraButton(e),e.deckEmpty&&e.era&&"rail"===e.era){const e=document.querySelector("[data-action='newGame']");e&&e.classList.remove("d-none")}else if(e.deckEmpty){const e=document.querySelector("[data-action='newGame']");e&&e.classList.remove("d-none")}e.hideDrawnCards||(this.currentCardContainer.innerHTML=r.createCurrentCardTemplate(e.currentCard)),e.showDiscardPile&&e.topDiscard&&(this.discardPileContainer.innerHTML=r.createDiscardPileTemplate(e.topDiscard)),this.nextCardContainer.innerHTML=r.createNextCardTemplate(e.nextCard)}hideRailEraButton(e){"rail"===e.era&&document.querySelectorAll("[data-canal]").forEach(e=>e.classList.add("d-none"))}toggleDrawButton(e){const t=document.querySelector("[data-action=draw]"),a=document.querySelector("[data-action=reshuffle]");e.deckEmpty?(t.classList.add("disabled"),t.disabled=!0,a&&!e.showReshuffle&&a.classList.remove("d-none")):(t.classList.remove("disabled"),a&&!e.showReshuffle&&a.classList.add("d-none"),t.disabled=!1)}showLoadGameModal(){$("#loadModal").modal("show")}toggleLoadingVisibility(){const e=document.getElementById("loading");e.classList.contains("d-none")?e.classList.remove("d-none"):e.classList.add("d-none")}toggleAppVisibility(){const e=document.getElementById("app");e.classList.contains("d-none")?e.classList.remove("d-none"):e.classList.add("d-none")}}},function(e,t,a){"use strict";const s={},r=function(){let e=0;return function(){return e+=1,e}}();const i={publish:function(e,t){s[e]&&Object.keys(s[e]).forEach(a=>s[e][a](t))},subscribe:function(e,t){const a=r();return s[e]||(s[e]={}),s[e][a]=t,{unsubscribe:()=>{delete s[e][a],0===Object.keys(s[e]).length&&delete s[e]}}}};t.a=i},,,,,function(e,t,a){"use strict";a.r(t);var s=a(5),r=a(6),i=a(0);const d=[];for(let e=0;e<9;e++)d.push(new i.a(e,`./images/${e+1}.png`,"./images/back.png",8==e?"reshuffle":"","base"));const n=[];for(let e=9;e<11;e++)n.push(new i.a(e,`./images/${e+1}.png`,"./images/back.png","","honeybee"));var c={baseCards:d,honeyBeeCards:n};const o=new(a(3).a);var l=a(4),u=a(1),h=a(2);function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var g=a(7);const w=new l.a,f=new class{constructor(e){this.key=`easternfront:${e}`}set(e){o.save(this.key,e)}clear(){o.clear(this.key)}getSavedState(){return o.load(this.key)}showLoadGameModal(){$("#loadModal").modal("show")}},p=new class{constructor(e,t){m(this,"removeSelectedCards",(e,t)=>{for(let a=0;a<e.length;a++){let s=e[a];t=t.filter(e=>e.id!=s.id)}return t}),m(this,"buildDeck",()=>{this.cardViewModel.cards=c.baseCards,u.a.shuffle(this.cardViewModel.cards)}),this.cardViewModel=e,this.cardViewModel.round=1,this.utilities=u.a,this.cardViewModel.showReshuffle=!0;const a=document.getElementById("draw"),s=document.getElementById("reshuffle");t.subscribe(h.a.RESHUFFLED,()=>{a.classList.remove("d-none"),s.classList.add("disabled"),s.classList.add("d-none"),s.disabled=!0}),t.subscribe(h.a.CARD_DRAWN,e=>{e.instructions.includes("reshuffle")&&(s.disabled=!1,s.classList.remove("disabled"),s.classList.remove("d-none"),a.classList.add("d-none"))}),t.subscribe(h.a.GAME_LOADED,e=>{this.cardViewModel=e;const t=document.getElementById("wrapper"),a=document.getElementById("startMenu"),s=document.getElementById("referenceToggle");if(u.a.show(t),u.a.hide(a),u.a.show(s),this.cardViewModel.settings.honeybee){document.getElementById("honeybeeReference").classList.remove("d-none")}}),document.addEventListener("click",e=>{if(e.target&&e.target.dataset&&e.target.dataset.action){switch(e.target.dataset.action){case"start":const t=document.getElementById("referenceToggle");if(u.a.show(t),this.cardViewModel.settings=this.cardViewModel.settings||{},this.cardViewModel.settings.honeybee){this.cardViewModel.cards=this.cardViewModel.cards.concat(c.honeyBeeCards),document.getElementById("honeybeeReference").classList.remove("d-none")}u.a.shuffle(this.cardViewModel.cards);const a=document.getElementById("wrapper");document.getElementById("startMenu").innerHTML="",a.classList.remove("d-none");break;case"setting":this.cardViewModel.settings||(this.cardViewModel.settings={}),this.cardViewModel.settings[e.target.dataset.setting]=e.target.checked}}});const r=setInterval(e=>{if("complete"===document.readyState){document.getElementById("startMenu").classList.remove("d-none"),clearInterval(r)}},1500)}deepCopy(e){return JSON.parse(JSON.stringify(e))}}(w,g.a),C=new r.a;new s.a(c.baseCards,C,f,p.buildDeck,w,null,null,g.a)}]);